<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Hall of Masters</title>
    <script src="https://cdn.jsdelivr.net/npm/chess.js@0.10.3/chess.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chessground@9.0.1/dist/chessground.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessground@9.0.1/assets/chessground.base.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessground@9.0.1/assets/chessground.brown.css">

    <style>
        body { background: #161512; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { display: flex; gap: 40px; flex-wrap: wrap; justify-content: center; }
        
        .board-wrapper {
            width: 480px; height: 480px;
            border: 10px solid #3d2d1e;
            background: #2b2b2b;
            position: relative;
        }

        #painel {
            width: 280px; background: #262421; padding: 20px; border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; border: 1px solid #444;
        }

        #foto-mestre {
            width: 200px; height: 200px; border-radius: 8px; border: 3px solid #c3a000;
            margin-bottom: 20px; object-fit: cover; background: #333;
        }

        .nome-mestre { color: #ffd700; font-size: 1.8em; font-weight: bold; margin-bottom: 25px; text-align: center; }
        
        .btn {
            width: 100%; padding: 20px; background: #c3a000; color: #000;
            border: none; font-weight: bold; cursor: pointer; border-radius: 8px;
            font-size: 1.1em; text-transform: uppercase;
        }
        
        #chess-board { width: 100%; height: 100%; }
    </style>
</head>
<body>

<div class="container">
    <div class="board-wrapper">
        <div id="chess-board" class="cg-wrap brown"></div>
    </div>

    <div id="painel">
        <img id="foto-mestre" src="fotos/Tal.jpg" onerror="this.src='https://via.placeholder.com/200?text=Carregando...'" alt="Mestre">
        <div class="nome-mestre" id="nome-mestre">MIKHAIL TAL</div>
        <button class="btn" id="botao-sorteio">Desafiar Mestre</button>
    </div>
</div>

<script>
    // 1. Inicializa o motor de xadrez
    const chess = new Chess();
    const boardNode = document.getElementById('chess-board');
    
    // 2. Tenta carregar o tabuleiro (com erro amigável)
    let cg;
    try {
        cg = Chessground(boardNode, {
            movable: { free: false, color: 'white', dests: getDests() }
        });
    } catch (e) {
        console.error("Erro ao carregar tabuleiro:", e);
        boardNode.innerHTML = "<p style='padding:20px'>Erro ao carregar o tabuleiro. Verifique a conexão.</p>";
    }

    function getDests() {
        const dests = new Map();
        chess.SQUARES.forEach(s => {
            const ms = chess.moves({ square: s, verbose: true });
            if (ms.length) dests.set(s, ms.map(m => m.to));
        });
        return dests;
    }

    // 3. Lógica do Botão (Versão Blindada)
    const mestres = ["Anand", "Capablanca", "Carlsen", "Fischer", "Karpov", "Keres", "Lasker", "Marshall", "Polgar", "Rubinstein", "Tal"];
    
    document.getElementById('botao-sorteio').addEventListener('click', function() {
        const mestreSorteado = mestres[Math.floor(Math.random() * mestres.length)];
        
        // Atualiza Texto e Foto
        document.getElementById('nome-mestre').innerText = mestreSorteado.toUpperCase();
        document.getElementById('foto-mestre').src = mestreSorteado + ".jpg";
        
        // Reinicia o jogo
        chess.reset();
        if (cg) cg.set({ fen: chess.fen(), lastMove: null });
        
        console.log("Desafio aceito por: " + mestreSorteado);
    });
</script>
</body>
</html>